# JSP



ëª©ì°¨

---

[ì„œë¸”ë¦¿ ê¸°ì´ˆ ë¬¸ë²•](ì„œë¸”ë¦¿-ê¸°ì´ˆ-ë¬¸ë²•)

[ê²Œì‹œíŒ ì‹¤ìŠµ, DBMS SQL](#ê²Œì‹œíŒ-ì‹¤ìŠµ,-dbms-sql)



---

## ì„œë¸”ë¦¿ ê¸°ì´ˆ ë¬¸ë²•



#### ì„œë¸”ë¦¿ì˜ ì£¼ìš” í´ë˜ìŠ¤

â–  HttpServlet
ì„œë¸”ë¦¿ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œ ë°˜ë“œì‹œ ìƒì†í•´ì•¼ í•  í•„ìˆ˜ í´ë˜ìŠ¤ìŠ¤
Servlet ì¸í„°í˜ì´ìŠ¤ > GenericServlet ì¶”ìƒí´ë˜ìŠ¤ > HttpServlet ìƒì†êµ¬ì¡°
ìœ„ì—ì„œ ì œê³µë˜ëŠ” ë§ì€ ë©”ì†Œë“œì‚¬ìš© ê°€ëŠ¥

![image-20210930091435686](JSP_2_0930.assets/image-20210930091435686.png)

â–  HttpServletRequest
í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ì˜ ì •ë³´ì— ëŒ€í•œ ìš”ì²­ ê°’ì„ ê°€ì§€ê³ 
 ìˆë‹¤.

![image-20210930091448108](JSP_2_0930.assets/image-20210930091448108.png)

â–  HttpServletResponse
í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ìœ„í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤.

![image-20210930091514956](JSP_2_0930.assets/image-20210930091514956.png)

â–  HttpSession
í´ë¼ì´ì–¸íŠ¸ê°€ ì„¸ì…˜ì •ë³´ë¥¼ ì €ì¥í•˜ê³ , ì„¸ì…˜ ê¸°ëŠ¥ì„ ìœ ì§€ í•˜ê¸° ìœ„í•´ì„œ ì œê³µëœë‹¤.

![image-20210930091551207](JSP_2_0930.assets/image-20210930091551207.png)



#### ì„œë¸”ë¦¿ì˜ ë¼ì´í”„ ì‚¬ì´í´

```
í´ë¼ì´ì–¸íŠ¸ ì„œë¸”ë¦¿ ìš”ì²­ -> init(ìµœì´ˆ í•œë²ˆ í˜¸ì¶œ) -> service, doGet(ë°˜ë³µì  í˜¸ì¶œ) -> destroy(ë§ˆì§€ë§‰ í•œë²ˆ í˜¸ì¶œ)
```

- init() : ì„œë¸”ë¦¿ì´ ì²˜ìŒìœ¼ë¡œ ìš”ì²­ì´ ë˜ì–´ ê°ì²´ê°€ ìƒì„± ë  ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
- service() : í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì´ ìˆì„ ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
- destroy() : ì„œë¸”ë¦¿ ì„œë¹„ìŠ¤ì˜ ì¢…ë£Œ ë° ì¬ì‹œì‘ ê·¸ë¦¬ê³  ì„œë¸”ë¦¿ ì½”ë“œê°€ ìˆ˜ì •ì´ ë  ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
- deGet() : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­í•  ë•Œ formì˜ methodê°€ get ë°©ì‹ì¼ ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ
- doPost() : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­í•  ë•Œ formì˜ methodê°€ post ë°©ì‹ì¼ ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œ



> ch07/ExServlet2.java

```
package ch07;

import java.io.IOException;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class ExServlet2
 */
@WebServlet("/ch07/ExServlet2")
public class ExServlet2 extends HttpServlet {
	private static final long serialVersionUID = 1L;

	/**
	 * @see Servlet#init(ServletConfig)
	 */
	public void init(ServletConfig config) throws ServletException {
		System.out.println("init() í˜¸ì¶œ");
	}

	/**
	 * @see Servlet#destroy()
	 */
	public void destroy() {
		System.out.println("destroy() í˜¸ì¶œ");
	}

	/**
	 * @see HttpServlet#service(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		System.out.println("service() í˜¸ì¶œ");	
	}

}

```

-- Output

> ì‹¤í–‰í•˜ë©´ ë¸Œë¼ìš°ì € í™”ë©´ì— ì•„ë¬´ê²ƒë„ ì—†ì´ ë³´ì—¬ì§„ë‹¤.
>
> ```
> http://localhost:8000/jsptest/ch07/ExServlet2
> ```
>
> 

> ì„œë²„ ì½˜ì†”ì°½ í™”ë©´
>
> init() ì€ ì²˜ìŒì— í•œë²ˆë§Œ, serviceëŠ” ìƒˆë¡œê³ ì¹¨í•  ë•Œë§ˆë‹¤ ë‹¤ì‹œ í˜¸ì¶œ
>
> ![image-20210930092911353](JSP_2_0930.assets/image-20210930092911353.png)
>
> í†°ìº£ ì„œë²„ë¥¼ ì •ì§€í•˜ë©´ (ê·¼ë° ì•ˆ ë³´ì˜€ìŒ)
>
> destory() í˜¸ì¶œ



### ì„œë¸”ë¦¿ì˜ ìš”ì²­ ë°©ì‹

- ë¸Œë¼ìš°ì €ì—ì„œ í˜ì´ì§€ ê°„ì— í†µì‹  í•  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ë°©ë²•ì€ formì—ì„œ ì œê³µë˜ëŠ” getë°©ì‹ê³¼ postë°©ì‹ì´ ìˆë‹¤.



#### getë°©ì‹

- ê²€ìƒ‰ì´ë‚˜ ì¡°ê±´ì„ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì „ì†¡í•  ë•Œ ì‚¬ìš©
- ìš”ì²­ì‹œ urlì— ë…¸ì¶œ ë˜ëŠ” íŠ¹ì§•ì´ ìˆìˆë‹¤.(ë³´ì•ˆì ì¸ ë‚´ìš©ì€ ì‚¬ìš©ì•ˆí•¨)

> servlet/getJsp.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>Get Servlet ë°©ì‹</h1>
	<form method="get" action="../ch07/getServlet">
		msg : <input name="msg"> <input type="submit" value="ì „ì†¡">
	</form>
</body>
</html>
```



> ch07/GetServlet.java

```java
package ch07;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class GetServlet
 */
@WebServlet("/ch07/getServlet")
public class GetServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse
	 *      response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String msg = request.getParameter("msg");
		response.setContentType("text/html; charset=UTF-8");
		PrintWriter out = response.getWriter();
		out.println("<html>");
		out.println("<body>");
		out.println("<h1>Get Servlet ë°©ì‹</h1>");
		out.println("<h2>msg : " + msg + "</h2>");
		out.println("</body>");
		out.println("</html>");
	}

}
```



#### post ë°©ì‹

- ê²Œì‹œíŒì— ê¸€ì„ ì…ë ¥í•˜ê±°ë‚˜ ë˜ëŠ” íšŒì›ê°€ì…ì„ í•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì „ì†¡í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤.
- urlì— ë…¸ì¶œë˜ì§€ ì•Šê³  html í—¤ë” ê°’ì— ê°™ì´ ì „ì†¡ëœë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ DB ì—°ë™ì„ í•œë‹¤ë©´ insert, update, update ì´ëŸ° ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì´ë‹¤.

> servlet/postJsp.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>Post Servlet ë°©ì‹</h1>
	<form method="post" action="../ch07/postServlet">
		id : <input name="id"><br /> 
		pwd : <input type="password" name="pwd"><br /> 
		email : <input name="email"><br /> 
		<input type="submit" value="ê°€ì…">
	</form>
</body>
</html>
```

> ch07/PostServlet.java

```java
package ch07;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class PostServlet
 */
@WebServlet("/ch07/postServlet")
public class PostServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		request.setCharacterEncoding("UTF-8");
        String id = request.getParameter("id");
        String pwd = request.getParameter("pwd");
        String email = request.getParameter("email");
        
        response.setContentType("text/html; charset=UTF-8");
        PrintWriter out = response.getWriter(); 
        out.println("<html>");
        out.println("<body>");
        out.println("<h1>Post Servlet ë°©ì‹</h1>");
        out.println("<h3>id : "+ id + "</h3>");
        out.println("<h3>pwd : "+ pwd + "</h3>");
        out.println("<h3>email : "+ email + "</h3>");
        out.println("</body>");
        out.println("</html>");
	}

}
```





## ê²Œì‹œíŒ ì‹¤ìŠµ, DBMS SQL

### ê²Œì‹œíŒ

- STS Setting
  type   : Dynamic Web Project
  name   : webtest
  packages : bbs, utility

- webtest/WEB-INF/lib/ojdbc8.jar(ì˜¤ë¼í´,ìë°” ì—°ë™)

bbs.sql

```sql
DROP TABLE bbs PURGE; 
 
CREATE TABLE bbs ( 
  bbsno    NUMBER(7)       NOT NULL,   -- ê¸€ ì¼ë ¨ ë²ˆí˜¸, -9999999 ~ +9999999 
  wname   VARCHAR(20)    NOT NULL,   -- ê¸€ì“´ì´ 
  title        VARCHAR(100)  NOT NULL,   -- ì œëª©(*) 
  content   VARCHAR(4000) NOT NULL,  -- ê¸€ ë‚´ìš© 
  passwd   VARCHAR(15)     NOT NULL,  -- ë¹„ë°€ ë²ˆí˜¸ 
  viewcnt   NUMBER(5)       DEFAULT 0,  -- ì¡°íšŒìˆ˜, ê¸°ë³¸ê°’ ì‚¬ìš© 
  wdate     DATE               NOT NULL,  -- ë“±ë¡ ë‚ ì§œ, sysdate 
  grpno     NUMBER(7)       DEFAULT 0, -- ë¶€ëª¨ê¸€ ë²ˆí˜¸ 
  indent    NUMBER(2)       DEFAULT 0,  -- ë‹µë³€ì—¬ë¶€,ë‹µë³€ì˜ ê¹Šì´
  ansnum  NUMBER(5)       DEFAULT 0,  -- ë‹µë³€ ìˆœì„œ 
  PRIMARY KEY (bbsno)  
); 

-- c(create, insert)
-- ì¼ë ¨ë²ˆí˜¸ ìƒì„±
SELECT max(bbsno) AS max FROM bbs;

SELECT * FROM bbs
ORDER BY bbsno asc;


SELECT nvl(max(bbsno),0)+1 AS bbsno FROM bbs;

INSERT INTO bbs(bbsno, wname, title, content, passwd, wdate)  
VALUES((SELECT NVL(MAX(bbsno), 0) + 1 as bbsno FROM bbs), 
'í™ê¸¸ë™', 'ê²Œì‹œíŒì œëª©', 'ê²Œì‹œíŒë‚´ìš©', '1234', sysdate);              


-- read(select)
UPDATE bbs
SET VIEWCNT = VIEWCNT + 1
WHERE bbsno=1;

SELECT * FROM bbs
WHERE bbsno = 1;

--update(ìˆ˜ì •)
UPDATE BBS
SET wname = 'ì™•ëˆˆì´',
	title = 'ì œëª©ìˆ˜ì •',
	content = 'ë‚´ìš© ìˆ˜ì •'
WHERE BBSNO = 1;

-- ë¹„ë²ˆ ê²€ì¦ (cnt : 1-ì¸ì¦ì„±ê³µ(1234) / cnt:0-ì¸ì¦ì‹¤íŒ¨(12345) )
SELECT count(bbsno) AS cnt
FROM bbs
WHERE bbsno = 1
AND PASSWD = '1234';


-- DELETE(ì‚­ì œ)
DELETE FROM BBS
WHERE bbsno=1;

--ëª©ë¡(í˜ì´ì§•, ê²€ìƒ‰)
SELECT bbsno, wname, title, content, viewcnt, wdate
FROM bbs
ORDER BY bbsno DESC;

SELECT bbsno, wname, passwd FROM bbs;


-- 1) ì„±ëª… ê²€ìƒ‰ ê¸€ ëª©ë¡(S:Search List) 
SELECT bbsno, wname, title, content, passwd, viewcnt, wdate, grpno, indent, ansnum 
FROM bbs  
WHERE wname LIKE '%ì™•ëˆˆì´%' 
ORDER BY bbsno DESC;  
 
 
-- 2) ì œëª© ê²€ìƒ‰ ê¸€ ëª©ë¡(S:Search List) 
SELECT bbsno, wname, title, content, passwd, viewcnt, wdate, grpno, indent, ansnum 
FROM bbs  
WHERE title LIKE '%ë…ë„%' 
ORDER BY bbsno DESC;  
 
 
 
-- 3) ë‚´ìš© ê²€ìƒ‰ ê¸€ ëª©ë¡(S:Search List) 
SELECT bbsno, wname, title, content, passwd, viewcnt, wdate, grpno, indent, ansnum 
FROM bbs  
WHERE content LIKE '%ë…ë„%' 
ORDER BY bbsno DESC;  
 
 
-- 4) íŒŒì´í”„ ê¸°í˜¸ë¥¼ í†µí•œ SQL ê²°í•© 
SELECT ('A' || 'B' || 'C' || 'D') as "grade" 
FROM dual; 

 
SELECT ('ë“±ë¡ì: ' || wname) as "wname"  
FROM bbs; 


```



### Design Pattern 
 \- list.jsp -> BbsDAO.java -> DBOpen.java, DBClose.java -> Oracle/MySQL DBMS 

![image-20210930120748737](JSP_2_0930.assets/image-20210930120748737.png)

### DBMS Connection ê´€ë¦¬ì í´ë˜ìŠ¤ 

> packagge utility;
>
> Constant.java, Open.java, DBClose.java (+ JDBC_Test.java)



-- Constant.java

```java
package utility;

public class Constant {
	public static final String DRIVER = "oracle.jdbc.pool.OracleDataSource";
			//.driver.OracleDriver";
	public static final String URL = "jdbc:oracle:thin:@orcldb_high?TNS_ADMIN=ì „ìì§€ê°‘ê²½ë¡œ";
	public static final String USER = "admin";
	public static final String PASSWORD = "ë¹„ë²ˆ";
}
```



-- Open.java

```java
package utility;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class Open {
  private static Connection con;

  public static Connection getConnection() {

    try {
      Class.forName(Constant.DRIVER);

      con = DriverManager.getConnection(Constant.URL, Constant.USER, Constant.PASSWORD);
   
      
    } catch (ClassNotFoundException | SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    return con;
  }

}
```



-- DBClose.java

```java
package utility;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DBClose {
  public static void close(PreparedStatement pstmt, Connection con) {
    try {
      if (pstmt != null)
        pstmt.close();
    } catch (SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    try {
      if (con != null)
        con.close();
    } catch (SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
  }

  public static void close(ResultSet rs, PreparedStatement pstmt, Connection con) {
    try {
      if (rs != null)
        rs.close();
    } catch (SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    try {
      if (pstmt != null)
        pstmt.close();
    } catch (SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
    try {
      if (con != null)
        con.close();
    } catch (SQLException e) {
      // TODO Auto-generated catch block
      e.printStackTrace();
    }
  }
}
```



>  JDBC_Test.java

```java
package utility;
 
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
 
 
/**
 * JAVA Client Test
 */
public class JDBC_Test {
 
    public static void main(String[] args) {
 
        Connection con = Open.getConnection();
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        
        // í…Œì´ë¸”ì˜ ê°¯ìˆ˜ ë¦¬í„´
        String sql="SELECT count(*) as cnt FROM tab";
        
        try{
            pstmt = con.prepareStatement(sql);
            
            rs = pstmt.executeQuery();
            if (rs.next() == true){
                System.out.println("í˜„ì¬ ìƒì„±ëœ í…Œì´ë¸” ê°¯ìˆ˜: " + rs.getInt("cnt"));
            }
        }catch(Exception e){
            System.out.println(e);
        }finally{
            DBClose.close(rs, pstmt, con);
        }
    }
}
```



#### DTO(Data Transfer Object, VO: Value Object) ìƒì„± 
- DTO(Data Transfer Object, Value Object, Bean, Domain) 
- í•˜ë‚˜ì˜ ë ˆì½”ë“œë¥¼ ê°ì²´ë¡œ ì €ì¥, ë ˆì½”ë“œê°€ 10ê°œì´ë©´ DTO(VO) ê°ì²´ë„ 10ê°œê°€ ìƒì„±
- í•„ë“œë“¤ì€ ì ‘ê·¼ ì œí•œìë¥¼ ì „ë¶€ privateìœ¼ë¡œ ì§€ì •
- oracleì˜ char, varchar, varchar2, dateëŠ” Stringìœ¼ë¡œ ì„ ì–¸
- number(5)ëŠ” intë¡œ ì„ ì–¸ 
- number(5, 1)ì€ float ë˜ëŠ” doubleë¡œ ì„ ì–¸, ì •ìˆ˜ 4ìë¦¬, ì†Œìˆ˜ì  ì´í•˜ 1ìë¦¬number(ì „ì²´ ìë¦¬ìˆ˜, ì†Œìˆ˜ì  ì´í•˜ ìë¦¬ìˆ˜) 
- ë©¤ë²„ ë³€ìˆ˜(í•„ë“œ)ì˜ ì ‘ê·¼ ë©”ì†Œë“œëŠ” publicìœ¼ë¡œ ì„ ì–¸ 
- í•„ë“œì˜ ì£¼ì„ì€ '/** */'ì˜ í˜•íƒœë¡œ DOC ì£¼ì„ì„ ì§€ì •
- SELECTëœ ë ˆì½”ë“œê°€ ë§ì€ ê²½ìš° ì˜¤ë¼í´ì€ SubQuery, MySQLì€ limitë“±ì„ ì´ìš©í•´ì„œ ë ˆì½”ë“œë¥¼ ë¶„í• í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.(Paging)   

â–  DTO ìƒì„± ê³¼ì • 
\- ë©¤ë²„ ë³€ìˆ˜(í•„ë“œ) ì„ ì–¸, ë©¤ë²„ ë³€ìˆ˜(í•„ë“œ) ì£¼ì„ ì²˜ë¦¬ 
\- ìƒì„±ì, getter, setter, toString ì„ ì–¸ 

> BbsDTO.java

```java
package bbs;

public class BbsDTO { 
	  /** ë²ˆí˜¸ */ 
	  private int bbsno; 
	  /** ê¸€ì“´ì´ */ 
	  private String wname; 
	  /** ì œëª© */ 
	  private String title; 
	  /** ë‚´ìš© */ 
	  private String content; 
	  /** íŒ¨ìŠ¤ì›Œë“œ */ 
	  private String passwd; 
	  /** ì¡°íšŒìˆ˜ */ 
	  private int viewcnt; 
	  /** ë“±ë¡ì¼ */ 
	  private String wdate; 
	  /** ê·¸ë£¹ ë²ˆí˜¸ */ 
	  private int grpno; 
	  /** ë‹µë³€ ì°¨ìˆ˜ */ 
	  private int indent; 
	  /** ë‹µë³€ ìˆœì„œ */ 
	  private int ansnum;
	public BbsDTO() {
		super();
		// TODO Auto-generated constructor stub
	}
	public BbsDTO(int bbsno, String wname, String title, String content, String passwd, int viewcnt, String wdate,
			int grpno, int indent, int ansnum) {
		super();
		this.bbsno = bbsno;
		this.wname = wname;
		this.title = title;
		this.content = content;
		this.passwd = passwd;
		this.viewcnt = viewcnt;
		this.wdate = wdate;
		this.grpno = grpno;
		this.indent = indent;
		this.ansnum = ansnum;
	}
	@Override
	public String toString() {
		return "BbsDTO [bbsno=" + bbsno + ", wname=" + wname + ", title=" + title + ", content=" + content + ", passwd="
				+ passwd + ", viewcnt=" + viewcnt + ", wdate=" + wdate + ", grpno=" + grpno + ", indent=" + indent
				+ ", ansnum=" + ansnum + "]";
	}
	public int getBbsno() {
		return bbsno;
	}
	public void setBbsno(int bbsno) {
		this.bbsno = bbsno;
	}
	public String getWname() {
		return wname;
	}
	public void setWname(String wname) {
		this.wname = wname;
	}
	public String getTitle() {
		return title;
	}
	public void setTitle(String title) {
		this.title = title;
	}
	public String getContent() {
		return content;
	}
	public void setContent(String content) {
		this.content = content;
	}
	public String getPasswd() {
		return passwd;
	}
	public void setPasswd(String passwd) {
		this.passwd = passwd;
	}
	public int getViewcnt() {
		return viewcnt;
	}
	public void setViewcnt(int viewcnt) {
		this.viewcnt = viewcnt;
	}
	public String getWdate() {
		return wdate;
	}
	public void setWdate(String wdate) {
		this.wdate = wdate;
	}
	public int getGrpno() {
		return grpno;
	}
	public void setGrpno(int grpno) {
		this.grpno = grpno;
	}
	public int getIndent() {
		return indent;
	}
	public void setIndent(int indent) {
		this.indent = indent;
	}
	public int getAnsnum() {
		return ansnum;
	}
	public void setAnsnum(int ansnum) {
		this.ansnum = ansnum;
	}
	  
}
```



#### DAO(Data(DBMS) Access Object) ì œì‘ 
\- ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•˜ì—¬ SQLì„ ì‹¤í–‰í•˜ëŠ” í´ë˜ìŠ¤ 

```java
package bbs;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Map;

import utility.DBClose;
import utility.Open;

public class BbsDAO {
	public boolean passCheck(Map map) {
		boolean flag = false;
		Connection con = Open.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" select count(bbsno) as cnt ");
		sql.append(" from bbs ");
		sql.append(" where bbsno = ? ");
		sql.append(" and passwd = ? ");
		
		int bbsno = (Integer)map.get("bbsno");
		String passwd = (String)map.get("passwd");
		
		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);
			pstmt.setString(2, passwd);
			
			rs = pstmt.executeQuery();
			
			rs.next();
			
			int cnt = rs.getInt("cnt");
			
			if(cnt>0) flag = true;
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(rs, pstmt, con);
		}
		
		
		return flag;
	}
	public void upViewcnt(int bbsno) {
		Connection con = Open.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" update bbs ");
		sql.append(" set viewcnt = viewcnt + 1 ");
		sql.append(" where bbsno = ? ");
		
		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setInt(1, bbsno);
			
			pstmt.executeUpdate();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}

	}
	
	public boolean create(BbsDTO dto) {
		boolean flag = false;
		Connection con = Open.getConnection();
		PreparedStatement pstmt = null;
		StringBuffer sql = new StringBuffer();
		sql.append(" insert into bbs(bbsno, wname, title, content, passwd, wdate) ");
		sql.append(" values((select nvl(max(bbsno),0) + 1 as bbsno from bbs), ");
		sql.append(" ?,?,?,?,sysdate) ");
		
		
		try {
			pstmt = con.prepareStatement(sql.toString());
			pstmt.setString(1, dto.getWname());
			pstmt.setString(2, dto.getTitle());
			pstmt.setString(3, dto.getContent());
			pstmt.setString(4, dto.getPasswd());
			
			int cnt = pstmt.executeUpdate();
			
			if(cnt>0)flag =true;
			
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally {
			DBClose.close(pstmt, con);
		}
				
		return flag;
	}
	
	public BbsDTO read(int bbsno) {
	    BbsDTO dto = null;
	    Connection con = Open.getConnection();
	    PreparedStatement pstmt = null;
	    ResultSet rs = null;
	 
	    StringBuffer sql = new StringBuffer();
	    sql.append(" SELECT bbsno, wname, title, content,  viewcnt, ");
	    sql.append(" to_char(wdate,'yyyy-mm-dd') wdate ");
	    sql.append(" FROM bbs   ");
	    sql.append(" WHERE bbsno = ?  ");
	 
	    try {
	      pstmt = con.prepareStatement(sql.toString());
	      pstmt.setInt(1, bbsno);
	 
	      rs = pstmt.executeQuery();
	 
	      if (rs.next()) {
	        dto = new BbsDTO();
	        dto.setBbsno(rs.getInt("bbsno"));
	        dto.setWname(rs.getString("wname"));
	        dto.setTitle(rs.getString("title"));
	        dto.setContent(rs.getString("content"));
	        dto.setViewcnt(rs.getInt("viewcnt"));
	        dto.setWdate(rs.getString("wdate"));
	      }
	 
	    } catch (SQLException e) {
	      // TODO Auto-generated catch block
	      e.printStackTrace();
	    } finally {
	      DBClose.close(rs, pstmt, con);
	    }
	 
	    return dto;
	  }
	
	public boolean update(BbsDTO dto) {
	    boolean flag = false;
	    Connection con = Open.getConnection();
	    PreparedStatement pstmt = null;
	    StringBuffer sql = new StringBuffer();
	    sql.append(" UPDATE bbs  ");
	    sql.append(" SET         ");
	    sql.append("    wname   = ?,  ");
	    sql.append("    title   = ?,  ");
	    sql.append("    content = ?  ");
	    sql.append(" WHERE bbsno  = ?  ");
	 
	    try {
	      pstmt = con.prepareStatement(sql.toString());
	      pstmt.setString(1, dto.getWname());
	      pstmt.setString(2, dto.getTitle());
	      pstmt.setString(3, dto.getContent());
	      pstmt.setInt(4, dto.getBbsno());
	 
	      int cnt = pstmt.executeUpdate();
	      if (cnt > 0)
	        flag = true;
	 
	    } catch (SQLException e) {
	      // TODO Auto-generated catch block
	      e.printStackTrace();
	    } finally {
	      DBClose.close(pstmt,con);
	    }
	 
	    return flag;
	  }
	 
	public boolean delete(int bbsno) {
	    boolean flag = false;
	    Connection con = Open.getConnection();
	    PreparedStatement pstmt = null;
	    StringBuffer sql = new StringBuffer();
	    sql.append(" delete from bbs ");
	    sql.append(" where bbsno = ? ");
	 
	    try {
	      pstmt = con.prepareStatement(sql.toString());
	      pstmt.setInt(1, bbsno);
	 
	      int cnt = pstmt.executeUpdate();
	      if (cnt > 0)
	        flag = true;
	 
	    } catch (SQLException e) {
	      // TODO Auto-generated catch block
	      e.printStackTrace();
	    } finally {
	      DBClose.close(pstmt,con);
	    }
	 
	    return flag;
	  }
}

```



> BbsTest.java

```java
package bbs;

public class BbsTest {
	public static void main(String[] args) {
		BbsDAO dao = new BbsDAO();
//		create(dao);
	    read(dao);
//	    update(dao);
//	    delete(dao);
	}

	private static void create(BbsDAO dao) {
		BbsDTO dto = new BbsDTO();
		dto.setWname("ê¹€ê¸¸ë™");
		dto.setTitle("ê²Œì‹œíŒ ì œëª©");
		dto.setContent("ê²Œì‹œíŒ ë‚´ìš©");
		dto.setPasswd("1234");
		if (dao.create(dto)) {
			p("ì„±ê³µ");

		} else {
			p("ì‹¤íŒ¨");
		}
	}

	private static void update(BbsDAO dao) {
		BbsDTO dto = dao.read(1);
		dto.setWname("ì•„ë¦¬");
		dto.setTitle("ì œëª© ìˆ˜ì •");
		dto.setContent("ìˆ˜ì •_ì˜¤ëŠ˜ì˜ ë‚ ì”¨ëŠ”..");

		if (dao.update(dto)) {
			p("ìˆ˜ì • ì„±ê³µ");
		} else {
			p("ìˆ˜ì • ì‹¤íŒ¨");
		}
	}
	
	private static void read(BbsDAO dao) {
	    BbsDTO dto = dao.read(1);
	    p(dto.toString());
	  }

	private static void delete(BbsDAO dao) {
		if (dao.delete(5)) { // 5 ë°©ê¸ˆ ì‚­ì œí•¨. row ì—†ì–´ì§.
			p("ì‚­ì œ ì„±ê³µ");
		} else {
			p("ì‚­ì œ ì‹¤íŒ¨");
		}
	}

	private static void p(String string) {
		System.out.println(string);
	}
}
```



#### ë“±ë¡ í¼

(webapp/bbs/)createForm.jsp , createProc.jsp

![image-20211001032147775](JSP_2_0930.assets/image-20211001032147775.png)



> createForm.jsp

```jsp
<%@ page contentType="text/html; charset=UTF-8" %> 
 
<!DOCTYPE html> 
<html> 
<head>
  <title>homepage</title>
  <meta charset="utf-8">
</head>
<body> 
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h1 class="col-sm-offset-2 col-sm-10">ê²Œì‹œíŒ ìƒì„±</h1>
<form class="form-horizontal" 
      action="createProc.jsp"
      method="post">

  <div class="form-group">
    <label class="control-label col-sm-2" for="wname">ì‘ì„±ì</label>
    <div class="col-sm-6">
      <input type="text" name="wname" id="wname" class="form-control">
    </div>
  </div>
  
  <div class="form-group">
    <label class="control-label col-sm-2" for="title">ì œëª©</label>
    <div class="col-sm-8">
      <input type="text" name="title" id="title" class="form-control">
    </div>
  </div>
  
  <div class="form-group">
    <label class="control-label col-sm-2" for="content">ë‚´ìš©</label>
    <div class="col-sm-8">
    <textarea rows="12" cols="7" id="content" name="content" class="form-control"></textarea>
    </div>
  </div>
  
  <div class="form-group">
    <label class="control-label col-sm-2" for="passwd">ë¹„ë°€ë²ˆí˜¸</label>
    <div class="col-sm-8">
      <input type="password" name="passwd" id="passwd" class="form-control">
    </div>
  </div>

   <div class="form-group">
   <div class="col-sm-offset-2 col-sm-5">
    <button class="btn">ë“±ë¡</button>
    <button type="reset" class="btn">ì·¨ì†Œ</button>
   </div>
 </div>
</form>
</div>
</body> 
</html> 
```

![image-20211001032512525](JSP_2_0930.assets/image-20211001032512525.png)

> createProc.jsp
>
> ë“±ë¡ ì²˜ë¦¬

```jsp
<%@ page contentType="text/html; charset=UTF-8"%>
<%
request.setCharacterEncoding("utf-8");
%>
<jsp:useBean class="bbs.BbsDAO" id="dao" />
<jsp:useBean class="bbs.BbsDTO" id="dto" />
<jsp:setProperty name="dto" property="*" />
<%
//String wname = request.getParameter("wname");
//dto.setWname(wname);
boolean flag = dao.create(dto);
%>
<!DOCTYPE html>
<html>
<head>
<title>ê²Œì‹œíŒ ìƒì„±</title>
<meta charset="utf-8">
</head>
<body>
	<jsp:include page="/menu/top.jsp" />
	<div class="container">
		<div class="well well-lg">
			<%
			if (flag) {
				out.print("ê¸€ ë“±ë¡ ì„±ê³µì…ë‹ˆë‹¤.");
			} else {
				out.print("ê¸€ ë“±ë¡ ì‹¤íŒ¨ì…ë‹ˆë‹¤.");
			}
			%>
		</div>
	</div>
</body>
</html>
```

![image-20211001032525736](JSP_2_0930.assets/image-20211001032525736.png)



## ì¡°íšŒ(read.jsp) ë° ì¡°íšŒìˆ˜ ì¦ê°€ 

<img src="JSP_2_0930.assets/image-20211001032743960.png" alt="image-20211001032743960" style="zoom:80%;" />



#### SQL

```sql
-- SQL 
UPDATE bbs 
SET viewcnt = viewcnt + 1 
WHERE bbsno=1; 

SELECT bbsno, wname, title, content, viewcnt, wdate
FROM bbs  
WHERE bbsno = 1; 
```



#### ì¡°íšŒ: ê¸€ ë“±ë¡ì„ ì°¸ì¡°í•˜ì—¬ ì‘ì„±

> /WebContent/bbs/read.jsp 

```jsp
<%@ page contentType="text/html; charset=UTF-8" %> 
<%@ page import="bbs.BbsDTO" %>
<jsp:useBean class="bbs.BbsDAO" id="dao" />
<%
	int bbsno = Integer.parseInt(request.getParameter("bbsno"));

	dao.upViewcnt(bbsno);
	
	BbsDTO dto = dao.read(bbsno);
	
	String content = dto.getContent().replaceAll("\r\n", "<br>");
%>
<!DOCTYPE html> 
<html> 
<head>
  <title>ê²Œì‹œíŒ</title>
  <meta charset="utf-8">
  <script>
  	function update(){
  		let url = 'updateForm.jsp';
  		url += '?bbsno=<%=dto.getBbsno()%>';
  		
  		location.href=url;
  	}
  	function del(){
  		let url = 'deleteForm.jsp';
  		url += '?bbsno=<%=dto.getBbsno()%>';
  		
  		location.href= url;
  	}
  </script>
</head>
<body> 
<jsp:include page="/menu/top.jsp"/>
<div class="container">
<h2>ì¡°íšŒ</h2>
<div class= "panel panel-default">
	<div class="panel-heading">ì‘ì„±ì</div>
	<div class="panel-body"><%=dto.getWname() %></div>
	
	<div class="panel-heading">ì œëª©</div>
	<div class="panel-body"><%=dto.getTitle() %></div>
	
	<div class="panel-heading">ë‚´ìš©</div>
	<div class="panel-body" style="height:200px"><%=content %></div>
	
	<div class="panel-heading">ì¡°íšŒìˆ˜</div>
	<div class="panel-body"><%=dto.getViewcnt() %></div>
	
	<div class="panel-heading">ë“±ë¡ì¼</div>
	<div class="panel-body"><%=dto.getWdate() %></div>

</div>

	<button class='btn' onclick="location.href='./createForm.jsp'">ë“±ë¡</button>
	<button class='btn' onclick="update()">ìˆ˜ì •</button>
	<button class='btn' onclick="del()">ì‚­ì œ</button>
	<button class='btn' onclick="location.href='./list.jsp'">ëª©ë¡</button>
<br>
<br>
</div>

</body> 
</html> 

```



> (ì—¬ê¸°ê¹Œì§€ ì§„í–‰ ì¤‘_read.jsp ë’¤ì— ì•„ì§ ì§ì ‘ ë¶™ì—¬ì¤˜ì•¼ í•¨.)
>
> read.jsp ìš”ì²­ì‹œ
>
> ```
> http://localhost:8000/webtest/bbs/read.jsp?bbsno=1
> ```
>
> `?bbsno=1` ë¶™ì—¬ì„œ í™•ì¸. ì•„ì§ ê²½ë¡œëª… ì œëŒ€ë¡œ ëª»ê°€ì ¸ì™€ì„œ bbsno ì§ì ‘ ë¶™ì—¬ì¤Œ.



> â—ï¸webtest -> java -> bbs/BbsDAO.java, BbsDTO.java, BbsTest.java 
>
> webtest -> webapp/bbs/
>
> createForm.jsp, createProc.jsp, deleteForm.jsp, deleteProc.jsp, read.jsp, updateForm.jsp, updateProc.jsp
>
> ê¹Œì§€ í”„ë¡œì íŠ¸ ì§„í–‰. ì²¨ë¶€í•œ ì½”ë“œë“¤ ; create, í•œ ê°œ í˜ì´ì§€ read, update ê¸°ëŠ¥ í¬í•¨.



*Fin.ğŸ§*

